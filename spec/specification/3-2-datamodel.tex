\section{Data Model}
The Data Model is a simple, object-oriented interface for database access. It wraps every record into a data-model instance, which handles all standard record operations. Creating new records through data-models happens over a data-model hull, which is a model without an \symbolref{_id}.

\symbolsection{class}{dm:data-model}
Base class for data-model instances. Any implementation is required to subclass this to provide their own data-model.

\symbolsection{function}{dm:id}
\extfuncdef{dm:id}{data-model}{\inline{_id}}{
  data-model &---& A \inline{data-model} instance.
}
Returns the \symbolref{_id} field of the current record associated with the data-model instance if there is any. In the case of a hull that has not yet been inserted, NIL is returned.

\symbolsection{accessor}{dm:field}
\extfuncdef{dm:field}{data-model field}{value}{
  data-model &---& A \inline{data-model} instance. \\
  field &---& A field name as string.
}
Accessor for the fields of the data-model record. If the record does not contain the requested field, NIL is returned instead. This function does not check for field name validity.

\symbolsection{function}{dm:get}
\extfuncdef{dm:get}{collection query \&key skip amount sort}{list}{
  collection &---& A string naming the collection.\\
  query &---& A query object, usually generated by \symbolref{db:query}\\
  skip &---& The amount of records to skip.\\
  amount &---& The amount of records to select.\\
  sort &::=& \inline{(sorting*)}\\
  sorting &::=& \inline{(field-name sort-order)} \\
  sort-order &::=& \inline{:ASC | :DESC} \\
}
This function works the same as \symbolref{db:select}, but instead of a list of record hash-tables, it returns a list of data-model instances. See \symbolref{db:select} for more info.

\symbolsection{function}{dm:get-one}
\extfuncdef{dm:get-one}{collection query \&key skip sort}{data-model}{
  collection &---& A string naming the collection.\\
  query &---& A query object, usually generated by \symbolref{db:query}\\
  skip &---& The amount of records to skip.\\
  sort &::=& \inline{(sorting*)}\\
  sorting &::=& \inline{(field-name sort-order)} \\
  sort-order &::=& \inline{:ASC | :DESC} \\
}
Selects the first record and creates a data-model of it. If no record at all is matched, NIL is returned instead. See \symbolref{db:select} for more info.

\symbolsection{function}{dm:hull}
\extfuncdef{dm:hull}{collection}{data-model}{
  collection &---& A string naming the collection.\\
}
Returns a new data-model hull for the given \inline{collection}. No test is made whether the collection actually exists or not. The \symbolref{_id} of the hull is set to NIL. \\

\noindent If the \inline{collection} name is not extended alphanumeric, an error of type \symbolref{DATABASE-INVALID-COLLECTION} is signalled.

\symbolsection{function}{dm:hull-p}
\extfuncdef{dm:hull-p}{data-model}{boolean}{
  data-model &---& A \inline{data-model} instance.
}
Returns T if the data-model is a hull that has not yet been inserted, NIL otherwise.

\symbolsection{function}{dm:save}
\extfuncdef{dm:save}{data-model}{data-model}{
  data-model &---& A \inline{data-model} instance.
}
Saves the record to the database, thus \symbolref{db:update}-ing all its fields to the values stored in the \inline{data-model}. The same data-model is returned. \\

\noindent If the supplied data-model is a hull, an error of type \symbolref{DATA-MODEL-NOT-INSERTED-YET} is signalled.

\symbolsection{function}{dm:delete}
\extfuncdef{dm:delete}{data-model}{data-model}{
  data-model &---& A \inline{data-model} instance.
}
Deletes the record from the database, thus \symbolref{db:remove}-ing it. This operation will set the \symbolref{_id} of the data-model to NIL, turning it into a hull. The same data-model is returned.\\

\noindent If the supplied data-model is a hull, an error of type \symbolref{DATA-MODEL-NOT-INSERTED-YET} is signalled.

\symbolsection{function}{dm:insert}
\extfuncdef{dm:insert}{data-model \&key clone}{data-model}{
  data-model &---& A \inline{data-model} instance. \\
  clone &---& A generalized boolean.
}
Inserts the \inline{data-model} as a new record into the database, thus \symbolref{db:insert}-ing it. If \inline{clone} is non-NIL, a new copy of the data-model is created with the \symbolref{_id} of the new record set; this copy is then returned. If \inline{clone} is NIL, the \symbolref{_id} field of the data-model is set to that of the new record and the data-model is returned. The supplied data-model can be a hull or a non-hull.
%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "master"
%%% End: 
